"use strict";

var BOMChar = '\uFEFF';

exports.PrependBOM = PrependBOMWrapper
/**
 * Wraps an encoder with functionality to prepend a Byte Order Mark (BOM).
 *
 * @class
 * @param {Encoder} encoder - The encoder whose output should be wrapped.
 * @param {Object} options - Configuration options for the wrapper.
 * @property {boolean} addBOM - Indicates whether to prepend a BOM when encoding. Default is true.
 */
function PrependBOMWrapper(encoder, options) {
    this.encoder = encoder;
    this.addBOM = true;
}

PrependBOMWrapper.prototype.write = function(str) {
    if (this.addBOM) {
        str = BOMChar + str;
        this.addBOM = false;
    }

    return this.encoder.write(str);
}

PrependBOMWrapper.prototype.end = function() {
    return this.encoder.end();
}


//------------------------------------------------------------------------------

exports.StripBOM = StripBOMWrapper;
/**
 * Wrapper function to strip Byte Order Mark (BOM) from text using a decoder.
 *
 * @class StripBOMWrapper
 * @param {Object} decoder - The decoder object used for text decoding.
 * @param {Object} [options] - Optional configuration options.
 */
function StripBOMWrapper(decoder, options) {
    this.decoder = decoder;
    this.pass = false;
    this.options = options || {};
}

StripBOMWrapper.prototype.write = function(buf) {
    var res = this.decoder.write(buf);
    if (this.pass || !res)
        return res;

    if (res[0] === BOMChar) {
        res = res.slice(1);
        if (typeof this.options.stripBOM === 'function')
            this.options.stripBOM();
    }

    this.pass = true;
    return res;
}

StripBOMWrapper.prototype.end = function() {
    return this.decoder.end();
}

